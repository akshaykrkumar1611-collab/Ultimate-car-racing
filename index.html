<!DOCTYPE html>
<html>
<head>
  <title>Ultimate Car Racing Game</title>
  <style>
    body {
      margin: 0;
      font-family: Arial;
      overflow: hidden;
      background: #222;
      color: white;
    }

    #score, #lives, #highScore {
      text-align: center;
      font-size: 20px;
      padding: 5px;
    }

    #road {
      width: 300px;
      height: 100vh;
      background: #555;
      margin: auto;
      position: relative;
      overflow: hidden;
      border-left: 5px solid white;
      border-right: 5px solid white;
    }

    .line {
      width: 10px;
      height: 80px;
      background: white;
      position: absolute;
      left: 145px;
    }

    #player {
      width: 40px;
      height: 70px;
      position: absolute;
      bottom: 10px;
      left: 130px;
      border-radius: 5px;
    }

    .enemy {
      width: 40px;
      height: 70px;
      position: absolute;
      top: -80px;
      border-radius: 5px;
    }

    #controls {
      display: flex;
      justify-content: space-around;
      padding: 10px;
    }

    button {
      font-size: 20px;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
    }

    #musicBtn, #nightBtn, #carSelect {
      margin: 5px;
      padding: 5px 10px;
      font-size: 16px;
      border-radius: 6px;
    }
  </style>
</head>

<body>

<div id="score">Score: 0</div>
<div id="lives">Lives: 3</div>
<div id="highScore">High Score: 0</div>

<div id="road">
  <div id="player"></div>
</div>

<div id="controls">
  <button onclick="moveLeft()">â¬…</button>
  <button onclick="moveRight()">âž¡</button>
</div>

<div style="text-align:center;">
  <button id="musicBtn">ðŸŽµ Music On</button>
  <button id="nightBtn">ðŸŒ™ Night Mode</button>
  <select id="carSelect">
    <option value="red">Red Car</option>
    <option value="cyan">Cyan Car</option>
    <option value="green">Green Car</option>
    <option value="orange">Orange Car</option>
    <option value="purple">Purple Car</option>
  </select>
</div>

<audio id="bgMusic" loop>
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<script>
const road = document.getElementById("road");
const player = document.getElementById("player");
const scoreText = document.getElementById("score");
const livesText = document.getElementById("lives");
const highScoreText = document.getElementById("highScore");

let score = 0;
let lives = 3;
let speed = 5;
let gameOver = false;
let nightMode = false;
const carColors = ["yellow", "blue", "green", "orange", "purple"];

let highScore = localStorage.getItem("highScore") || 0;
highScoreText.innerText = "High Score: " + highScore;

// Set player car color
const carSelect = document.getElementById("carSelect");
player.style.background = carSelect.value;
carSelect.addEventListener("change", () => {
  player.style.background = carSelect.value;
});

// Music
const bgMusic = document.getElementById("bgMusic");
let musicPlaying = false;
document.getElementById("musicBtn").onclick = () => {
  if(musicPlaying){
    bgMusic.pause();
    musicPlaying = false;
    document.getElementById("musicBtn").innerText = "ðŸŽµ Music Off";
  } else {
    bgMusic.play();
    musicPlaying = true;
    document.getElementById("musicBtn").innerText = "ðŸŽµ Music On";
  }
}

// Night mode
document.getElementById("nightBtn").onclick = () => {
  nightMode = !nightMode;
  if(nightMode){
    document.body.style.background = "#000";
    road.style.background = "#222";
  } else {
    document.body.style.background = "#222";
    road.style.background = "#555";
  }
}

// Road lines
for(let i=0;i<5;i++){
  let line = document.createElement("div");
  line.className = "line";
  line.style.top = i*120 + "px";
  road.appendChild(line);
}

function moveRoad(){
  document.querySelectorAll(".line").forEach(line => {
    line.style.top = line.offsetTop + speed + "px";
    if(line.offsetTop > window.innerHeight){
      line.style.top = "-100px";
    }
  });
}

function moveLeft(){
  if(player.offsetLeft > 0) player.style.left = player.offsetLeft - 40 + "px";
}
function moveRight(){
  if(player.offsetLeft < 260) player.style.left = player.offsetLeft + 40 + "px";
}

function createEnemy(){
  if(gameOver) return;

  const enemy = document.createElement("div");
  enemy.className = "enemy";
  enemy.style.left = Math.floor(Math.random()*6)*40 + "px";
  enemy.style.background = carColors[Math.floor(Math.random()*carColors.length)];
  road.appendChild(enemy);

  const fall = setInterval(()=>{
    if(gameOver) return;
    enemy.style.top = enemy.offsetTop + speed + "px";

    if(collision(player, enemy)){
      lives--;
      livesText.innerText = "Lives: " + lives;
      enemy.remove();
      clearInterval(fall);

      if(lives <= 0){
        alert("ðŸ’¥ Game Over!\nScore: " + score);
        gameOver = true;
        if(score > highScore) {
          localStorage.setItem("highScore", score);
          alert("ðŸ† New High Score: " + score);
        }
        location.reload();
      }
    }

    if(enemy.offsetTop > window.innerHeight){
      enemy.remove();
      clearInterval(fall);
      score++;
      scoreText.innerText = "Score: " + score;
      if(score % 5 === 0) speed++;
    }
  },30);
}

function collision(a,b){
  return !(a.offsetTop + a.offsetHeight < b.offsetTop ||
           a.offsetTop > b.offsetTop + b.offsetHeight ||
           a.offsetLeft + a.offsetWidth < b.offsetLeft ||
           a.offsetLeft > b.offsetLeft + b.offsetWidth);
}

function gameLoop(){
  moveRoad();
  requestAnimationFrame(gameLoop);
}

gameLoop();
setInterval(createEnemy,1000);
</script>

</body>
  </html>
